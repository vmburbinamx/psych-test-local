---
  title: "Análisis de información."
author: "Víctor Urbina"
date: "4/7/2019"
output: html_document
runtime: shiny
---
  
  ```{r setup, include=FALSE}
library(ProjectTemplate)
library(data.table)
library(ggplot2)
library(plotly)
load.project()
```

### Explorando los datos.

- Estructura general.
```{r}
glimpse(test.data)

```


- Agrupación (por año).
```{r}
test.data %>% 
  group_by(year) %>% 
  tally()

```

- Agrupación (por año/campus).
```{r}
test.data %>% 
  group_by(year, campusName) %>% 
  tally()

```

- Agrupación (por usuario) - conteo de registros por usuario.
```{r}
test.data %>% 
  group_by(idUser_int) %>% 
  tally()

```

- Conteo de usuarios únicos.
```{r}
test.data %>% 
  summarise(n_distinct(idUser_int))

```

- Conteo de usuarios por número de registros disponibles (por cada año/campus)
```{r}
test.data %>% 
  group_by(year, campusName, idUser_int) %>% 
  summarise(records = n()) %>% 
  group_by(year, campusName, records) %>% 
  summarise(users = n())

```


- Conteo de preguntas
```{r}
test.data %>% 
  group_by(idQuestion) %>% 
  tally()

```

- Un caso de ejemplo: resultados de examen aplicado en el **Campus A** en el **2019** para el usuario **1104**.
```{r}
test.data %>% 
  filter(campusName == "Campus A") %>% 
  filter(year==2019) %>% 
  filter(idUser_int==1104)

```

### Acerca de la pregunta 1.

En un data frame, ¿cuáles son los parámetros (dificultad y discriminación) de los ítems en 2018? De acuerdo a los datos disponibles en el *path* **data/test_data.csv**
  
  #### (i) Calcular la dificultad por campus/item.
  
  ```{r}
pregunta1a <- test.data %>% 
  filter(year==2018) %>% 
  group_by(year, campusName, idQuestion) %>% 
  summarise(count_of_students = n_distinct(idUser_int),
            students_with_correct_answers = sum(isCorrect, na.rm = TRUE)) %>% 
  mutate(difficulty = (students_with_correct_answers/count_of_students)*100) %>% 
  arrange(desc(difficulty)) %>% 
  data.table()
```

#### Tabla

```{r, echo=FALSE}
renderDataTable(
  pregunta1a,
  options = list(pageLength=5)
)
```

#### Distribución

```{r, echo=FALSE}
renderPlotly(
  pregunta1a %>% 
    ggplot(aes(x=difficulty))+
    geom_histogram(bins = 10)
)
```

#### (ii) Calcular la dificultad por item.

```{r}
pregunta1b <- test.data %>% 
  filter(year==2018) %>% 
  group_by(year, idQuestion) %>% 
  summarise(count_of_students = n_distinct(idUser_int),
            students_with_correct_answers = sum(isCorrect, na.rm = TRUE)) %>% 
  mutate(difficulty = (students_with_correct_answers/count_of_students)*100) %>% 
  arrange(desc(difficulty)) %>% 
  data.table()
```

#### Tabla

```{r, echo=FALSE}
renderDataTable(
  pregunta1b,
  options = list(pageLength=5)
)
```

#### Distribución

```{r, echo=FALSE}
renderPlotly(
  pregunta1b %>% 
    ggplot(aes(x=difficulty))+
    geom_histogram(bins = 10)
)
```

#### (iii) Calcular la discriminación por campus/item.

```{r}
pregunta1c <- test.data %>% 
  filter(year==2018) %>% 
  group_by(year, campusName, idQuestion) %>% 
  summarise(count_of_students = n_distinct(idUser_int),
            students_with_correct_answers = sum(isCorrect, na.rm = TRUE)) %>% 
  mutate(difficulty = (students_with_correct_answers/count_of_students)*100) %>%
  arrange(campusName,idQuestion) %>% 
  data.table()

pregunta1c[,percentile := ntile(students_with_correct_answers,100), by=list(campusName)]

```

```{r, echo=FALSE}
renderDataTable(
  pregunta1c,
  options = list(pageLength=5)
)
```


### Acerca de la pregunta 2.

El ranking de las escuelas por nivel académico, de acuerdo a los datos disponibles en el *path* **data/test_data.csv**
  
  
  ```{r}
#Calcular percentiles

```
